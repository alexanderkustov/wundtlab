var osname=Ti.Platform.osname,RSS_URL="mobileweb"===osname?"/feed.xml":"http://localhost:3000/studies.rss",MONTH_MAP={JAN:1,FEB:2,MAR:3,APR:4,MAY:5,JUN:6,JUL:7,AUG:8,SEP:9,OCT:10,NOV:11,DEC:12},getRssText=function(e,t){return"mobileweb"===osname?e.getElementsByTagName(t).item(0).textContent:e.getElementsByTagName(t).item(0).text},parseDate=function(e){var t=e.split(" "),r=t[4].split(":");return MONTH_MAP[t[2].toUpperCase()]+"/"+t[1]+" "+r[0]+":"+r[1]};exports.loadRssFeed=function(e,t){var r=Titanium.Network.createHTTPClient();t=t||0,r.open("GET",RSS_URL),r.onload=function(){var r=this.responseXML;if(null===r||null===r.documentElement)return 3>t?(t++,exports.loadRssFeed(e,t),void 0):(alert("Error reading RSS feed. Make sure you have a network connection and try refreshing."),e.error&&e.error(),void 0);for(var a=r.documentElement.getElementsByTagName("item"),i=[],o=0;o<a.length;o++){var n=a.item(o);try{var s=n.getElementsByTagName("mash:thumbnail").item(0).text,l=s.match(/src="([^\"]*)"/gim),m=l[0].replace(/src=|"/gim,"")}catch(d){m=""}i.push({title:getRssText(n,"title"),link:getRssText(n,"link"),pubDate:parseDate(getRssText(n,"pubDate")),image:m})}e.success&&e.success(i)},r.onerror=function(){e.error&&e.error()},e.start&&e.start(),r.send()};